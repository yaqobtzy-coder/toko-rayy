<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const db = getDatabase(initializeApp({ databaseURL: "https://rayy-all-web-default-rtdb.asia-southeast1.firebasedatabase.app/" }));

    // ELEMENT CACHE
    const mainContent = document.getElementById('main-content');
    const bodyElement = document.body;

    // LOGIC AUTO-LISTEN (REAL-TIME)
    onValue(ref(db, 'settings'), (snap) => {
        const s = snap.val();
        if(!s) return;

        const now = new Date();
        const mNow = now.getHours() * 60 + now.getMinutes();
        let isLock = false;
        let msg = "";

        // Cek Jadwal Otomatis
        if(s.jadwal?.auto) {
            const [hB, mB] = s.jadwal.buka.split(':').map(Number);
            const [hT, mT] = s.jadwal.tutup.split(':').map(Number);
            if (mNow < (hB*60+mB) || mNow > (hT*60+mT)) {
                isLock = true;
                msg = `Server tutup otomatis. Buka pukul ${s.jadwal.buka} WIB.`;
            }
        }

        // Cek Manual Lock (Prioritas Dev)
        if (s.toko_locked) {
            isLock = true;
            msg = "Sistem dinonaktifkan sementara oleh Developer Rayy.";
        }

        // EKSEKUSI TANPA REFRESH
        if (isLock) {
            bodyElement.innerHTML = `
                <div class="overlay-offline" id="off-screen">
                    <div class="box-msg">
                        <h1>SERVER OFFLINE</h1>
                        <p>${msg}</p>
                        <div style="margin-top:20px; font-size:0.7rem; opacity:0.5;">RAYY STORE SYSTEM V4.0</div>
                    </div>
                </div>`;
        } else {
            // Kalau tiba-tiba dibuka (Unlocked), halaman bakal balik normal
            if(document.getElementById('off-screen')) {
                location.reload(); // Hanya reload jika sebelumnya layar offline aktif
            }
        }
    });

    // ... sisa fungsi prosesPembayaran lu tetap sama ...
</script>
