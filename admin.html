<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rayy - Admin Monitor</title>
    <style>
        :root {
            --primary: #38bdf8;
            --bg: #0b1120;
            --card: #1e293b;
            --dark: #0f172a;
            --text: #f8fafc;
            --red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }

        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: 0.8s;
        }
        .logo-box { width: 90px; height: 90px; background: var(--primary); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 900; color: #000; }

        .container { max-width: 500px; margin: auto; padding: 20px; padding-top: 60px; opacity: 0; transition: 1s; }
        .visible { opacity: 1; }

        .card { background: var(--card); padding: 30px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.05); }
        input { width: 100%; padding: 18px; background: var(--dark); border: 2px solid transparent; color: white; border-radius: 15px; margin-bottom: 10px; text-align: center; }
        input:focus { border-color: var(--primary); }
        
        .btn-login { width: 100%; padding: 18px; border: none; border-radius: 15px; background: var(--primary); color: #000; font-weight: 900; cursor: pointer; }

        .item { background: var(--dark); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
        
        /* OVERLAY PESAN */
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:10001; display:flex; align-items:center; justify-content:center; padding:30px; text-align:center; }
        .box { border: 2px solid var(--primary); padding: 40px; border-radius: 30px; background: rgba(56,189,248,0.05); }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo-box">R</div>
    </div>

    <div class="container" id="main-content">
        <div id="loginPage">
            <div class="card">
                <h2 style="text-align:center; margin-bottom:20px; color:var(--primary);">ADMIN LOGIN</h2>
                <input type="text" id="adminUser" placeholder="Username">
                <input type="password" id="adminPass" placeholder="Password">
                <button class="btn-login" onclick="authAdmin()">LOGIN MONITOR</button>
            </div>
        </div>

        <div id="monitorArea" style="display:none;">
            <h2 style="margin-bottom:20px;">Riwayat Transaksi</h2>
            <div id="historyList"></div>
            <button onclick="location.reload()" style="margin-top:20px; width:100%; padding:10px; background:transparent; border:1px solid #ef4444; color:#ef4444; border-radius:10px;">LOGOUT</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://rayy-all-web-default-rtdb.asia-southeast1.firebasedatabase.app/" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const OWNER_KEY = "085794";
        let currentAdminUser = "";

        // 1. CEK SERVER MONITOR TUTUP
        onValue(ref(db, 'settings/toko_locked'), (snap) => {
            if (snap.val() === true) {
                document.body.innerHTML = `
                <div class="overlay">
                    <div class="box">
                        <h1 style="color:var(--primary);">SERVER TUTUP</h1>
                        <p>Server monitoring transaksi di tutup Harap kembali besok pagi pukul 09:00 WIB</p>
                    </div>
                </div>`;
            }
        });

        // 2. CEK BLOKIR ADMIN REAL-TIME
        function startAdminCheck(username) {
            if(username === "Owner Rayy") return;
            onValue(ref(db, 'sys_extra_admins'), (snap) => {
                const admins = snap.val();
                let exists = false;
                for(let id in admins) {
                    if(admins[id].user === username) { exists = true; break; }
                }
                if(!exists) {
                    document.body.innerHTML = `
                    <div class="overlay">
                        <div class="box" style="border-color:#ef4444;">
                            <h1 style="color:#ef4444;">AKUN DIBLOKIR</h1>
                            <p>Akun Admin anda Telah di blokir oleh developer/owner silahkan hubungi owner Rayy</p>
                            <p style="margin-top:20px; font-size:0.9rem; opacity:0.7;">WhatsApp: 08XXXXXXXXXX</p>
                        </div>
                    </div>`;
                }
            });
        }

        window.authAdmin = function() {
            const u = document.getElementById('adminUser').value.trim();
            const p = document.getElementById('adminPass').value.trim();

            if(p === OWNER_KEY) {
                showMonitor("Owner Rayy");
                return;
            }

            onValue(ref(db, 'sys_extra_admins'), (snap) => {
                const admins = snap.val();
                let found = false;
                for(let id in admins) {
                    if(admins[id].user === u && admins[id].pass === p) {
                        found = true;
                        break;
                    }
                }
                if(found) { 
                    currentAdminUser = u;
                    showMonitor(u);
                    startAdminCheck(u);
                } else { 
                    alert("Akses Ditolak!"); 
                }
            }, { onlyOnce: true });
        }

        function showMonitor(adminName) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('monitorArea').style.display = 'block';
            push(ref(db, 'sys_login_logs'), { user: adminName, time: new Date().toLocaleString() });

            onValue(ref(db, 'transactions'), (snapshot) => {
                const list = document.getElementById('historyList');
                list.innerHTML = "";
                const data = snapshot.val();
                if(data) {
                    Object.keys(data).reverse().forEach(id => {
                        const item = data[id];
                        list.innerHTML += `<div class="item"><b>${item.nama}</b><br><small>Rp ${item.jumlah} - ${item.waktu}</small></div>`;
                    });
                }
            });
        }

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main-content').classList.add('visible');
                }, 800);
            }, 2000);
        };
    </script>
</body>
</html>
