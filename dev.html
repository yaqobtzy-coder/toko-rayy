<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rayy Dev Panel - Auto Schedule v3.0</title>
    <style>
        :root {
            --primary: #38bdf8;
            --bg: #0b1120;
            --card: #1e293b;
            --dark: #0f172a;
            --text: #f8fafc;
            --red: #ef4444;
            --green: #22c55e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        .card { background: var(--card); padding: 30px; border-radius: 30px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        h2 { color: var(--primary); margin-bottom: 20px; font-weight: 900; text-align: center; }
        .grid-settings { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .status-box { padding: 20px; border-radius: 20px; background: var(--dark); text-align: center; border: 2px solid transparent; transition: 0.3s; }
        .status-on { border-color: var(--green); color: var(--green); }
        .status-off { border-color: var(--red); color: var(--red); }
        input, select { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--dark); color: white; margin-top: 10px; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 900; cursor: pointer; margin-top: 10px; text-transform: uppercase; transition: 0.3s; }
        .btn-blue { background: var(--primary); color: #0b1120; }
        .btn-red { background: var(--red); color: white; }
        .btn-green { background: var(--green); color: white; }
        .list-item { background: var(--dark); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <h2>DEV CONTROL PANEL</h2>

    <div class="card">
        <p style="text-align:center; opacity:0.6; font-size:0.8rem; margin-bottom:15px;">KONTROL MANUAL SERVER</p>
        <div class="grid-settings">
            <div id="statusManual" class="status-box">MEMUAT...</div>
            <button class="btn btn-blue" onclick="toggleServer()">SWITCH MANUAL</button>
        </div>
    </div>

    <div class="card">
        <p style="text-align:center; opacity:0.6; font-size:0.8rem; margin-bottom:15px;">JADWAL BUKA/TUTUP OTOMATIS</p>
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <label style="font-size:0.7rem;">JAM BUKA</label>
                <input type="time" id="openTime">
            </div>
            <div style="flex:1;">
                <label style="font-size:0.7rem;">JAM TUTUP</label>
                <input type="time" id="closeTime">
            </div>
        </div>
        <button class="btn btn-green" onclick="saveJadwal()">SIMPAN JADWAL OTOMATIS</button>
    </div>

    <div class="card">
        <h3>MANAJEMEN AKSES</h3>
        <input type="text" id="targetUser" placeholder="Username (Untuk Admin/Ban)">
        <input type="text" id="targetPass" placeholder="Password (Hanya untuk Admin)">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-blue" onclick="addAdmin()" style="font-size:0.7rem;">TAMBAH ADMIN</button>
            <button class="btn btn-red" onclick="banUser()" style="font-size:0.7rem;">BAN USER/ADMIN</button>
        </div>
    </div>

    <div class="card">
        <p style="opacity:0.5; font-size:0.8rem;">DAFTAR BANNED USER</p>
        <div id="banList" style="margin-top:10px;"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { databaseURL: "https://rayy-all-web-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 1. MONITOR STATUS MANUAL & JADWAL
    onValue(ref(db, 'settings'), (snap) => {
        const data = snap.val();
        const statBox = document.getElementById('statusManual');
        if(data.toko_locked) {
            statBox.innerHTML = "STATUS: CLOSED";
            statBox.className = "status-box status-off";
        } else {
            statBox.innerHTML = "STATUS: OPEN";
            statBox.className = "status-box status-on";
        }
        if(data.jadwal) {
            document.getElementById('openTime').value = data.jadwal.buka;
            document.getElementById('closeTime').value = data.jadwal.tutup;
        }
    });

    // 2. TOGGLE MANUAL
    window.toggleServer = function() {
        onValue(ref(db, 'settings/toko_locked'), (snap) => {
            update(ref(db, 'settings'), { toko_locked: !snap.val() });
        }, { onlyOnce: true });
    }

    // 3. SAVE JADWAL
    window.saveJadwal = function() {
        const buka = document.getElementById('openTime').value;
        const tutup = document.getElementById('closeTime').value;
        if(!buka || !tutup) return alert("Isi Jam!");
        update(ref(db, 'settings/jadwal'), { buka, tutup, auto: true }).then(() => alert("Jadwal Disimpan!"));
    }

    // 4. ADD ADMIN
    window.addAdmin = function() {
        const user = document.getElementById('targetUser').value;
        const pass = document.getElementById('targetPass').value;
        if(!user || !pass) return alert("Isi data!");
        set(ref(db, 'sys_extra_admins/' + user), { user, pass }).then(() => alert("Admin Ditambah!"));
    }

    // 5. BAN USER
    window.banUser = function() {
        const user = document.getElementById('targetUser').value;
        if(!user) return alert("Isi Nama!");
        set(ref(db, 'banned_users/' + user), { status: "banned" }).then(() => alert("User Di-Ban!"));
    }

    // 6. TAMPILKAN DAFTAR BAN
    onValue(ref(db, 'banned_users'), (snap) => {
        const list = document.getElementById('banList');
        list.innerHTML = "";
        snap.forEach(child => {
            list.innerHTML += `<div class="list-item"><span>${child.key}</span><button onclick="unban('${child.key}')" style="color:red; background:none; border:none; cursor:pointer;">HAPUS</button></div>`;
        });
    });

    window.unban = (id) => { remove(ref(db, 'banned_users/' + id)); }
</script>
</body>
</html>
