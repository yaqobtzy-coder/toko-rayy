<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEV | ARCHITECT</title>
    <style>
        :root { --neon: #00ff00; --bg: #000; --red: #ff4d4d; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:monospace; }
        body { background: var(--bg); color: var(--neon); padding-bottom: 50px; }

        /* LOGIN FIX (GAK GEPENG) */
        #login-zone { position:fixed; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:30px; }
        .login-card { width:100%; max-width:320px; text-align:center; }
        .login-input { width:100%; padding:18px; background:#111; border:1px solid var(--neon); color:var(--neon); margin-bottom:15px; border-radius:10px; text-align:center; font-size:1rem; }
        .login-btn { width:100%; padding:18px; background:var(--neon); color:#000; border:none; font-weight:bold; border-radius:10px; cursor:pointer; font-size:1rem; }

        /* UI PANEL */
        #dev-ui { padding:20px; display:none; }
        .box { border:1px solid #222; padding:20px; border-radius:12px; margin-bottom:15px; background:rgba(0,255,0,0.01); }
        h3 { font-size:0.8rem; margin-bottom:10px; color:#fff; }
        .action-btn { width:100%; padding:14px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; margin-top:10px; }
        
        /* CHAT MONITOR */
        #admin-chat-list { height:200px; overflow-y:auto; background:#050505; border:1px solid #111; padding:10px; }
        .chat-item { padding:10px; border-bottom:1px solid #111; cursor:pointer; font-size:0.8rem; }
        .chat-item:active { background:#111; }
    </style>
</head>
<body>

    <div id="login-zone">
        <div class="login-card">
            <h2 style="margin-bottom:30px;">[ ARCHITECT AUTH ]</h2>
            <input type="password" id="key" class="login-input" placeholder="ACCESS KEY">
            <button onclick="unlock()" class="login-btn">ENTER SYSTEM</button>
        </div>
    </div>

    <div id="dev-ui">
        <h1 style="color:white; margin-bottom:20px;">SYSTEM <span style="color:var(--neon);">CONTROL</span></h1>
        
        <div class="box">
            <h3>MASTER KILL SWITCH</h3>
            <div id="stat" style="padding:15px; text-align:center; border-radius:6px; font-weight:bold;">CHECKING...</div>
            <button onclick="toggleSrv()" class="action-btn" style="background:#fff;">SWITCH ONLINE/OFFLINE</button>
        </div>

        <div class="box">
            <h3>LIVE CHAT (BALAS PESAN)</h3>
            <div id="admin-chat-list"></div>
            <div id="reply-area" style="display:none; margin-top:10px;">
                <input type="text" id="reply-input" placeholder="Tulis balasan..." style="width:100%; padding:12px; background:#111; border:1px solid #333; color:white; border-radius:5px;">
                <button onclick="replyMsg()" class="action-btn" style="background:var(--neon); color:#000;">KIRIM BALASAN</button>
            </div>
        </div>

        <div class="box">
            <h3>USER RESTRICTION</h3>
            <input type="text" id="t-user" placeholder="Target Username" style="width:100%; padding:12px; background:#111; border:1px solid #333; color:white;">
            <button onclick="ban()" class="action-btn" style="background:var(--red); color:white;">BAN USER</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, get, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const db = getDatabase(initializeApp({ databaseURL: "https://rayy-all-web-default-rtdb.asia-southeast1.firebasedatabase.app/" }));

        window.unlock = () => {
            if(document.getElementById('key').value === "085794") {
                document.getElementById('login-zone').style.display = 'none';
                document.getElementById('dev-ui').style.display = 'block';
            } else { alert("WRONG KEY!"); }
        };

        // KONTROL SERVER
        window.toggleSrv = async () => {
            const r = ref(db, 'settings/toko_locked');
            const s = await get(r);
            set(r, !s.val());
        };

        onValue(ref(db, 'settings/toko_locked'), snap => {
            const locked = snap.val();
            const s = document.getElementById('stat');
            s.innerText = locked ? "OFFLINE (LOCKED)" : "ONLINE (LIVE)";
            s.style.background = locked ? "var(--red)" : "var(--neon)";
            s.style.color = locked ? "white" : "black";
        });

        // KONTROL CHAT
        let targetUid = "";
        onValue(ref(db, 'live_chats'), snap => {
            const list = document.getElementById('admin-chat-list'); list.innerHTML = "";
            const data = snap.val();
            if(data) {
                Object.keys(data).forEach(uid => {
                    const last = Object.values(data[uid]).pop();
                    const div = document.createElement('div');
                    div.className = "chat-item";
                    div.innerHTML = `<b style="color:var(--neon)">${uid}</b>: ${last.text}`;
                    div.onclick = () => { targetUid = uid; document.getElementById('reply-area').style.display='block'; alert("Membalas: "+uid); };
                    list.appendChild(div);
                });
            }
        });

        window.replyMsg = () => {
            const input = document.getElementById('reply-input');
            if(!input.value || !targetUid) return;
            push(ref(db, `live_chats/${targetUid}`), {
                sender: 'admin',
                text: input.value,
                time: new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'})
            });
            input.value = "";
        };

        window.ban = () => { /* Logic Ban Sama Seperti Dulu */ };
    </script>
</body>
</html>
