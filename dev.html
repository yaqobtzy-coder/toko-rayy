<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEV PANEL | RAYY ARCHITECT</title>
    <style>
        :root { --neon: #00ff00; --bg: #0b0f19; --red: #ff4d4d; --wa: #075e54; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: #fff; padding: 15px; }

        .box { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        h3 { font-size: 0.9rem; color: var(--neon); margin-bottom: 15px; letter-spacing: 1px; }
        
        /* CHAT STYLE WA DI DEV */
        #admin-chat-list { height: 150px; overflow-y: auto; background: #0d1117; border-radius: 10px; padding: 10px; margin-bottom: 10px; }
        .chat-row { padding: 10px; border-bottom: 1px solid #21262d; cursor: pointer; display: flex; justify-content: space-between; }
        .chat-window { height: 300px; background: #e5ddd5; border-radius: 10px; display: flex; flex-direction: column; overflow: hidden; margin-top: 10px; }
        .chat-msgs { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .m-dev { padding: 8px 12px; border-radius: 8px; max-width: 80%; font-size: 0.85rem; color: #000; }
        .m-dev.admin { background: #dcf8c6; align-self: flex-end; }
        .m-dev.user { background: #fff; align-self: flex-start; }

        /* INPUTS & BUTTONS */
        input { width: 100%; padding: 12px; background: #0d1117; border: 1px solid #30363d; color: #fff; border-radius: 8px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-green { background: var(--neon); color: #000; }
        .btn-red { background: var(--red); color: #fff; }

        /* LIST BANNED */
        .ban-item { display: flex; justify-content: space-between; padding: 8px; background: #0d1117; border-radius: 5px; margin-bottom: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h2 style="text-align:center; margin-bottom:20px;">SYSTEM <span style="color:var(--neon)">DASHBOARD</span></h2>

    <div class="box">
        <h3>PENGATURAN JAM OPERASIONAL</h3>
        <div style="display:flex; gap:10px;">
            <input type="time" id="jam-buka">
            <input type="time" id="jam-tutup">
        </div>
        <button class="btn btn-green" onclick="saveJadwal()">SIMPAN JADWAL</button>
        <p style="font-size:0.7rem; margin-top:10px; opacity:0.5;">*Server otomatis OFFLINE di luar jam ini jika AUTO aktif.</p>
    </div>

    <div class="box">
        <h3>WHATSAPP LIVE CHAT</h3>
        <div id="admin-chat-list"></div>
        <div class="chat-window" id="win-chat" style="display:none;">
            <div style="background:var(--wa); padding:10px; font-weight:bold;" id="chat-target-name">Membalas...</div>
            <div class="chat-msgs" id="chat-screen"></div>
            <div style="padding:10px; background:#f0f0f0; display:flex; gap:5px;">
                <input type="text" id="rep-txt" placeholder="Balas..." style="margin:0; color:#000; background:#fff;">
                <button onclick="reply()" style="padding:10px; background:var(--wa); color:white; border:none; border-radius:5px;">KIRIM</button>
            </div>
        </div>
    </div>

    <div class="box">
        <h3>USER RESTRICTION</h3>
        <input type="text" id="inp-ban" placeholder="Username Pembeli">
        <button class="btn btn-red" onclick="prosesBan()">BAN USER</button>
        <h4 style="margin: 15px 0 10px; font-size:0.8rem;">DAFTAR TERBLOKIR:</h4>
        <div id="list-banned"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const db = getDatabase(initializeApp({ databaseURL: "https://rayy-all-web-default-rtdb.asia-southeast1.firebasedatabase.app/" }));

        // 1. JADWAL OTOMATIS
        window.saveJadwal = () => {
            const b = document.getElementById('jam-buka').value;
            const t = document.getElementById('jam-tutup').value;
            if(b && t) set(ref(db, 'settings/jadwal'), { buka: b, tutup: t, auto: true });
            alert("Jadwal Disimpan!");
        };

        // 2. CHAT LOGIC
        let activeUser = "";
        onValue(ref(db, 'live_chats'), snap => {
            const list = document.getElementById('admin-chat-list'); list.innerHTML = "";
            snap.forEach(child => {
                const div = document.createElement('div');
                div.className = "chat-row";
                div.innerHTML = `<span>${child.key}</span> <small>Click to chat</small>`;
                div.onclick = () => openChat(child.key);
                list.appendChild(div);
            });
        });

        function openChat(uid) {
            activeUser = uid;
            document.getElementById('win-chat').style.display = "flex";
            document.getElementById('chat-target-name').innerText = "Chatting with: " + uid;
            onValue(ref(db, `live_chats/${uid}`), snap => {
                const screen = document.getElementById('chat-screen'); screen.innerHTML = "";
                snap.forEach(msg => {
                    const m = msg.val();
                    screen.innerHTML += `<div class="m-dev ${m.sender}">${m.text}</div>`;
                });
                screen.scrollTop = screen.scrollHeight;
            });
        }

        window.reply = () => {
            const txt = document.getElementById('rep-txt');
            if(!txt.value || !activeUser) return;
            push(ref(db, `live_chats/${activeUser}`), { sender: 'admin', text: txt.value, time: new Date().toLocaleTimeString() });
            txt.value = "";
        };

        // 3. BAN & LIST UNBAN
        window.prosesBan = () => {
            const u = document.getElementById('inp-ban').value;
            if(u) set(ref(db, 'banned_users/'+u), { status: 'BANNED' });
        };

        onValue(ref(db, 'banned_users'), snap => {
            const box = document.getElementById('list-banned'); box.innerHTML = "";
            snap.forEach(child => {
                box.innerHTML += `<div class="ban-item"><span>${child.key}</span> <button onclick="unban('${child.key}')" style="background:none; border:none; color:var(--red); cursor:pointer;">UNBAN</button></div>`;
            });
        });

        window.unban = (u) => { if(confirm("Buka blokir "+u+"?")) remove(ref(db, 'banned_users/'+u)); };
    </script>
</body>
</html>
